
$(function(){
	//var timeStamp = new Date().getTime()+'';
    //timeStamp=timeStamp.slice(0,-3);
    var timeStamp = $.format.date(new Date(), "yyyyMMddHHmmss");
    $('#header_timeStamp_value').val(timeStamp);
});

function getSign(method,url,client,secret,timestamp,body){
	var msg = method+'\n'+url;
	//if(){} //requestParameter
	msg = msg+'\n'+'x-co-client:'+client+'\n'+'x-co-timestamp:'+timestamp;
    if(body){
        msg = msg+'\n'+CryptoJS.MD5(body);
    }
    
    //alert(msg);
    var signStr = CryptoJS.HmacSHA1(msg,secret);
    //alert(signStr);
    var signWA = CryptoJS.enc.Utf8.parse(signStr.toString().toUpperCase()); 
    //signStr = signStr.toUpperCase().toString(CryptoJS.enc.Base64);
    signStr = CryptoJS.enc.Base64.stringify(signWA);
    //alert(signStr+"333");
    return signStr;
}

$('button').click(function () {
    var method = $('select').val();
    var url = $('#url').val();
    var client = $('#header_client_value').val();
    var secret = $('#header_secret_value').val();
    var body = $('#body').val();
    var timestamp = $('#header_timeStamp_value').val();
    
    if(method.length==0 || client.length ==0 || secret.length==0 || url.length==0 || timestamp.length==0){
    	alert("paramError!!!");
    }else{
    	var sign = getSign(method,url,client,secret,timestamp);
    	$('#header_sign_value').val(sign);
    	postmethod(url,method,client,timestamp,sign,body);
    }

});

function postmethod(url,method,client,time,sign,body) {

    var contentType = 'application/json';
    if('GET' == method){
        body=null;
        contentType = 'application/x-www-form-urlencoded';
    }

    $.ajax({
        type:method,
        url:url,
        beforeSend: function(xhr) {
            xhr.setRequestHeader("X-Co-Client",client);
            xhr.setRequestHeader("X-Co-TimeStamp",time);
            xhr.setRequestHeader("X-Co-Sign",sign);
        },
        dataType:'text',
        contentType:contentType,
        data:body,
        success:function (data) {
            console.log(data);
            $('#return').val(data);
        }
    })
}
